<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#000"><meta name="generator" content="Hexo 7.3.0"><link rel="preconnect" href="https://fonts.font.im" crossorigin><link rel="preconnect" href="https://s4.zstatic.net" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/logo.svg" color="#000"><link rel="manifest" href="/images/site.webmanifest"><meta name="google-site-verification" content="google6cab6888cf331a89"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.font.im/css2?family=EB+Garamond:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Cinzel+Decorative:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=STZhongsong:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Source+Code+Pro:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/pace/1.2.4/themes/blue/pace-theme-center-atom.css"><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"yuzhii0718.eu.org","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.21.1","exturl":true,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/config.min.js"></script><meta name="keywords" content="en7562,en7562ct,Openwrt,刷机,en7523,en7529,en7529ct,en7563,en7563pt,econet,airoha,达发,atf,uboot,u-boot"><meta name="description" content="en7529ct&#x2F;en7562ct&#x2F;an7563pt，ECONET&#x2F;达发芯片，airoha SoC 构成分析，OpenWrt 支持研究。我们不需要费心思去解决驱动问题，因为可以使用大厂开源的 GPL 代码。"><meta property="og:type" content="article"><meta property="og:title" content="达发 airoha en7529&#x2F;en7562&#x2F;an7563 等基于 en7523 的 SoC 构成分析以及 OpenWrt 支持研究（下）"><meta property="og:url" content="https://yuzhii0718.eu.org/2025/07/10/1/index.html"><meta property="og:site_name" content="Yuzhii&#39;s Blog"><meta property="og:description" content="en7529ct&#x2F;en7562ct&#x2F;an7563pt，ECONET&#x2F;达发芯片，airoha SoC 构成分析，OpenWrt 支持研究。我们不需要费心思去解决驱动问题，因为可以使用大厂开源的 GPL 代码。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://yuzhii0718.eu.org/2025/07/10/1/BLOCKDIAGRAM.png"><meta property="article:published_time" content="2025-07-10T03:05:43.000Z"><meta property="article:modified_time" content="2025-09-04T06:59:38.440Z"><meta property="article:author" content="Yuzhii"><meta property="article:tag" content="分享"><meta property="article:tag" content="玩机"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://yuzhii0718.eu.org/2025/07/10/1/BLOCKDIAGRAM.png"><link rel="canonical" href="https://yuzhii0718.eu.org/2025/07/10/1/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://yuzhii0718.eu.org/2025/07/10/1/","path":"2025/07/10/1/","title":"达发 airoha en7529/en7562/an7563 等基于 en7523 的 SoC 构成分析以及 OpenWrt 支持研究（下）"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>达发 airoha en7529/en7562/an7563 等基于 en7523 的 SoC 构成分析以及 OpenWrt 支持研究（下） | Yuzhii's Blog</title><script>((e,t,n,r,a,c)=>{e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},(a=t.createElement(r)).async=1,a.src="https://www.clarity.ms/tag/l2jrn68m1i",(c=t.getElementsByTagName(r)[0]).parentNode.insertBefore(a,c)})(window,document,"clarity","script")</script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Yuzhii's Blog</p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">15</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">81</span></a></li><li class="menu-item menu-item-application"><a href="/html/index.html" rel="section"><i class="fa fa-store fa-fw"></i>应用</a></li><li class="menu-item menu-item-alist"><span class="exturl" data-url="aHR0cHM6Ly9hbGlzdC55dXpoaWkwNzE4LmV1Lm9yZw=="><i class="fa fa-hard-drive fa-fw"></i>网盘</span></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#SoC-%E6%9E%84%E6%88%90%E7%A0%94%E7%A9%B6"><span class="nav-number">1.</span> <span class="nav-text">SoC 构成研究</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E5%8E%9F%E5%8E%82%E7%9A%84%E7%BC%96%E8%AF%91%E4%BF%A1%E6%81%AF%E5%88%86%E6%9E%90"><span class="nav-number">1.1.</span> <span class="nav-text">从原厂的编译信息分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E5%A4%87%E6%A0%91%E6%9E%84%E5%BB%BA%E7%8C%9C%E6%83%B3"><span class="nav-number">1.2.</span> <span class="nav-text">设备树构建猜想</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA"><span class="nav-number">1.3.</span> <span class="nav-text">结论</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenWrt-%E6%94%AF%E6%8C%81%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7"><span class="nav-number">2.</span> <span class="nav-text">OpenWrt 支持的可能性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E6%9C%8815%E6%97%A5%E8%AE%B0%E5%BD%95"><span class="nav-number">2.1.</span> <span class="nav-text">6月15日记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E6%9C%8829%E6%97%A5%E6%9B%B4%E6%96%B0"><span class="nav-number">2.2.</span> <span class="nav-text">6月29日更新</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenWrt-%E5%AE%9E%E6%88%98%E7%A0%94%E7%A9%B6"><span class="nav-number">3.</span> <span class="nav-text">OpenWrt 实战研究</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E-uboot"><span class="nav-number">4.</span> <span class="nav-text">关于 uboot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">4.1.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%BC%80%E6%BA%90%E4%BB%A5%E5%8F%8A%E5%91%8A%E4%B8%80%E6%AE%B5%E8%90%BD"><span class="nav-number">5.</span> <span class="nav-text">相关开源以及告一段落</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">6.</span> <span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Yuzhii" src="/images/avatar.png"><p class="site-author-name" itemprop="name">Yuzhii</p><div class="site-description" itemprop="description">Yuzhii 的博客，记录生活中的点滴，技术笔记，路由器光猫研究，学习笔记等。</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">81</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">3</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="mailto:admin@yuzhii0718.eu.org" title="E-Mail → mailto:admin@yuzhii0718.eu.org" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div></div></div></div><div class="pjax"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://yuzhii0718.eu.org/2025/07/10/1/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Yuzhii"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Yuzhii's Blog"><meta itemprop="description" content="Yuzhii 的博客，记录生活中的点滴，技术笔记，路由器光猫研究，学习笔记等。"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="达发 airoha en7529/en7562/an7563 等基于 en7523 的 SoC 构成分析以及 OpenWrt 支持研究（下） | Yuzhii's Blog"><meta itemprop="description" content="en7529ct/en7562ct/an7563pt，ECONET/达发芯片，airoha SoC 构成分析，OpenWrt 支持研究。我们不需要费心思去解决驱动问题，因为可以使用大厂开源的 GPL 代码。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">达发 airoha en7529/en7562/an7563 等基于 en7523 的 SoC 构成分析以及 OpenWrt 支持研究（下）</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-07-10 11:05:43" itemprop="dateCreated datePublished" datetime="2025-07-10T11:05:43+08:00">2025-07-10</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-09-04 14:59:38" itemprop="dateModified" datetime="2025-09-04T14:59:38+08:00">2025-09-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>5.2k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>19 分钟</span></span></div><div class="post-description">en7529ct/en7562ct/an7563pt，ECONET/达发芯片，airoha SoC 构成分析，OpenWrt 支持研究。我们不需要费心思去解决驱动问题，因为可以使用大厂开源的 GPL 代码。</div></div></header><div class="post-body" itemprop="articleBody"><style>:root{--primary-color:#4a6cf7;--primary-hover:#3151e4;--text-color:#333;--background:#f9f9f9;--card-bg:#ffffff;--shadow-color:rgba(0, 0, 0, 0.1);--transition-speed:0.3s}.card{flex:0 0 auto;width:calc(33.333% - 11px);min-width:280px;scroll-snap-align:center;transition:all .3s ease;height:160px;padding:30px;border-radius:12px;box-shadow:0 4px 15px var(--shadow-color);cursor:pointer;position:relative;overflow:hidden;border:1px solid rgba(0,0,0,.05)}.card:hover{transform:scale(1.05);box-shadow:0 10px 20px rgba(0,0,0,.2);z-index:10}.card-title{font-size:1.4rem;margin-bottom:12px;color:var(--text-color);position:relative;transition:color var(--transition-speed)}.card:hover .card-title{color:var(--primary-color)}.card-title::after{content:'';position:absolute;bottom:-5px;left:0;width:0;height:2px;background-color:var(--primary-color);transition:width var(--transition-speed) ease}.card:hover .card-title::after{width:50px}.card-content{color:#666;font-size:.95rem}.card-container::-webkit-scrollbar{display:none}.card-container{-ms-overflow-style:none;scrollbar-width:none}</style><p>接上文 <a href>SDG320 en7562ct ax3000 研究（上）</a></p><h2 id="SoC-构成研究">SoC 构成研究</h2><p>提出出来的 dts 是 en7523 的，有点意思，看起来这颗 SoC 不简单，应该是胶水封装的。</p><div class="card"><p class="card-title">相关文件</p><p class="card-content"><b>有兴趣就研究一下吧！</b></p><a href="./collection.tar.gz" download="en7562-collection.tar.gz" target="_blank" class="btn" data-pjax-state="load">下载</a></div><details><summary>点击展开相关研究过程</summary><h3 id="从原厂的编译信息分析">从原厂的编译信息分析</h3><p>/userfs/profile.cfg 有着一些编译信息。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;512k[bootloader],12m[rescue],1280k[reservearea],256k[romfile],5m[kernela],33m[rootfsa],5m[kernelb],33m[rootfsb],6m[data],50m[java],78m[osgi]&quot;</span><br></pre></td></tr></table></figure><p>这个分区信息是移动版本的，其他版本的是下面这样的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;512k[bootloader],12m[rescue],1280k[reservearea],256k[romfile],5m[kernela],33m[rootfsa],5m[kernelb],33m[rootfsb],6m[data],16m[plugin1],16m[plugin2],96m[plugin3]&quot;</span><br></pre></td></tr></table></figure><p>UBOOT 2014 版本 ATF2_1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TCSUPPORT_ARM_SECURE_BOOT=y</span><br><span class="line"># TCSUPPORT_SECURE_BOOT is not set</span><br></pre></td></tr></table></figure><p>这两个 SECURE_BOOT 有什么区别吗？应该上面这个是 ATF 的。</p><p>如果有高手，可以结合开源的 ATF 代码，尝试制作一个多功能 UBOOT，就像 uboot-mt798x 一样</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TCSUPPORT_ETHPHY=5R_DIS</span><br><span class="line">TCSUPPORT_7562_CD=y</span><br><span class="line">TCSUPPORT_GCC10_3_0_GLIBC2_32_KERNEL5_4=y</span><br><span class="line"><span class="comment"># WAN Transfer Mode Support</span></span><br><span class="line">TCSUPPORT_SWITCH_8850=y</span><br><span class="line">TCSUPPORT_BUSYBOXCONFIG_TC3262=y</span><br></pre></td></tr></table></figure><p>这里只选取了最重要的差别，其他系统定义上的差别、驱动特性的差别没有给出。</p><p><code>TCSUPPORT_BUSYBOXCONFIG_TC3262=y</code> 指定了使用了 TC3262 的 BusyBox 配置。TC3262 是 TrendChip 的一个 SoC 系列，可能是为了兼容性或特定功能。</p><blockquote><p>TcBoot 是从 TrendChip 的 TC3262 衍生而来的极简引导加载程序。可能是为了支持 A/B 分区的相关特性，或是 NAND BBT/BMT 相关功能。</p></blockquote><p>某些编译信息，来自固件里打包的某些文件，这应该是编译 Airoha SDK 的工具链。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@Ubuntu:tmp# /home/sdks/OEM/airoha_en75xx-evb2023/bin/arm-linux-gcc -v</span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=/home/sdks/OEM/buildroot-gcc1030-glibc232_kernel5_4/bin/arm-linux-gcc.br_real</span><br><span class="line">COLLECT_LTO_WRAPPER=/home/sdks/OEM/buildroot-gcc1030-glibc232_kernel5_4/bin/../libexec/gcc/arm-buildroot-linux-gnueabi/10.3.0/lto-wrapper</span><br><span class="line">Target: arm-buildroot-linux-gnueabi</span><br><span class="line">Configured with: ./configure --prefix=/opt/trendchip/buildroot-gcc1030-glibc232_kernel5_4 --sysconfdir=/opt/trendchip/buildroot-gcc1030-glibc232_kernel5_4/etc --enable-static --target=arm-buildroot-linux-gnueabi --with-sysroot=/opt/trendchip/buildroot-gcc1030-glibc232_kernel5_4/arm-buildroot-linux-gnueabi/sysroot --enable-__cxa_atexit --with-gnu-ld --disable-libssp --disable-multilib --disable-decimal-float --with-gmp=/opt/trendchip/buildroot-gcc1030-glibc232_kernel5_4 --with-mpc=/opt/trendchip/buildroot-gcc1030-glibc232_kernel5_4 --with-mpfr=/opt/trendchip/buildroot-gcc1030-glibc232_kernel5_4 --with-pkgversion=&#x27;Buildroot -g413d1bb&#x27; --with-bugurl=http://bugs.buildroot.net/ --without-zstd --disable-libquadmath --disable-libquadmath-support --enable-tls --enable-plugins --enable-lto --enable-threads --without-isl --without-cloog --with-float=soft --with-abi=aapcs-linux --with-cpu=cortex-a7 --with-float=soft --with-mode=arm --enable-languages=c,c++ --with-build-time-tools=/opt/trendchip/buildroot-gcc1030-glibc232_kernel5_4/arm-buildroot-linux-gnueabi/bin --enable-shared --disable-libgomp</span><br><span class="line">Thread model: posix</span><br><span class="line">Supported LTO compression algorithms: zlib</span><br><span class="line">gcc version 10.3.0 (Buildroot -g413d1bb)</span><br></pre></td></tr></table></figure><blockquote><p>没有源码，看个乐呵。</p></blockquote><h3 id="设备树构建猜想">设备树构建猜想</h3><p>以下是进行推测的过程，可以直接跳到末尾最新的部分。</p><p>当然，<strong>这些都是推测，不保准准确，没有看到 dieshot 时，谁也不能确定</strong>。</p><hr><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29wZW53cnQvb3BlbndydC9jb21taXQvZDlmYTE1NWQwMTNkYjk5MmNmMzkyODU3NTZlMTUzMTgyNmQ5YjU0ZQ==">airoha: add support for Gemtek W1700K<i class="fa fa-external-link-alt"></i></span></p><p>这个提交展示了如何在带有 Secure Boot 的达发设备上引导系统。W1700K 是一个基于 an7581 的设备，使用了 Secure Boot 机制。</p><p>我感觉有戏，感觉可以为该设备提供 OpenWrt 支持。但是主线上的 an7523 只有验证样品的 DTS 文件，没有模板。</p><p>不过话又说会来了，这个 dts 貌似不太完整，比如 keys、led 的 GPIO 都没有，而且也没有分区信息，应该是藏在内核脚本里了，还是要ttl看启动信息。</p><p>见参考资料 <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>。</p><p>gdma 应该是一个 dma 设备，而 gdm 是一个以太网 mac 设备，frame_engine 集成了以太网相关的部分。</p><p>在 <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> 中提到：</p><blockquote><p>R5408M 的四个 2.5G 口是直通 CPU 的，…CPU EN7562C 里面集成有一个千兆交换机，5-8 号千兆口就是走这个交换芯片。…</p></blockquote><p>参考<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>:</p><blockquote><p>…CPU型号是EN7652CT，双核A53架构，频率1GHz，集成4个千兆PHY。…</p></blockquote><p>以及原厂编译配置文件中的</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TCSUPPORT_HSGMII_LAN=y</span><br></pre></td></tr></table></figure><p>结合 <sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> 、<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup> 的信息以及使用 <code>ifconfig</code>/<code>iwconfig</code> 命令查看到的网口信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">eth0</span><br><span class="line">eth0.2</span><br><span class="line">eth0.3</span><br><span class="line">eth0.4</span><br></pre></td></tr></table></figure><p>可以确定，这确实是有一个千兆交换机内置在 en7562ct SoC 之中。GMAC1 扩展支持 SGMII 和 HSGMII</p><div class="card"><p class="card-title">EN8850 SERIES</p><p class="card-content"><a>EN8850 是达发的一款交换机芯片，支持多种网络接口和协议</a></p><a href="./EN8850SERIES.pdf" download="EN8850SERIES.pdf" target="_blank" class="btn" data-pjax-state="load">下载</a></div><p>估计应该和 <code>EN8850DRE</code> 差不多</p><p>而设备树中包含了 <code>wdma</code> 和 <code>wed</code>，设备树中使用 <code>en751221</code> 作为兼容硬件，可能同样兼容 EN7526。</p><p>Pcie 方面，en7562ct 使用了兼容 mt7520 的 pcie 通道</p><p>而 hsgmii 是提供 2.5Gbps 内部接口(Interface)，或为 pon/xpon 提供支持。</p><p>参考<sup class="footnote-ref"><a href="#fn3" id="fnref3:1">[3:1]</a></sup>:</p><blockquote><p>…T和U的差别，从价格和扩展性来看，就差在3个HSGMII接口上。…</p></blockquote><p>千兆网口(PHY)来自内部的以太网交换机芯片。</p><blockquote><p>额外发现，airoha 的交换机芯片，后缀不一样，它们的结构可能也不相同，故此驱动可能也并不通用，特定型号只能期待 MTK/AIROHA 开源了。</p></blockquote><p>以及可以发现，小米 BE5000，使用了 en7563PT 处理器，推测该芯片应该是 en7562 的更新换代。以及还有一款 极客AP 也使用了 en7563pt 方案。</p><p>解包小米固件后，发现该 dts 与 an7562 的内核提取 dts 非常相似，也是基于 an7523 的设备树，但是多了 an7581 的 oop-table 频率表，GPIO、分区表、thermal-zones等。</p><p>另外，我们也可以查看另一个不同架构 SoC en751221 的相关资料，已经有人发表相关的文章。具体见参考资料 <sup class="footnote-ref"><a href="#fn1" id="fnref1:1">[1:1]</a></sup>。也已经有人为其适配 Linux/OpenWrt。</p></details><hr><p>en7561 一般搭配 MT7905DEN+MT7975DN 配置成 ax1800<br>en7562 一般搭配 MT7976DN+MT7916AN 配置成 ax3000<br>an7963 一般搭配 MT7976CN+MT7991AV/BV 配置成 be3600/be5000</p><blockquote><p>另外，airoha 的命名很混乱，en7561 是 mips 架构的，en7562/7563 是 arm 架构的，据说 en7561 是 mt7621 的改版，如果要尝试为 en7561 提供 OpenWrt 支持，可以参考 mt7621 的相关代码。</p></blockquote><h3 id="结论">结论</h3><p>7月9日更新</p><p>概述：</p><p>EN7562CT 是用于 xPON 应用的高度集成的单芯片解决方案。</p><p>它集成了四个以太网 GPHY、一个 DDR3 控制器、一个 USB3.0 Host、一个 USB2.0 Host、两个 PCIe Gen2 端口，以及用于 VoIP 应用的具有 ISI/ZSI 兼容接口的 PCM 控制器，从而完全满足未来智能家居网关的要求。</p><p>EN7562CT 采用 1.0GHz ARM CA53 双核 CPU 和强大的 Xmart PacketAccelerator（XPA），它可以支持无与伦比的网络功能，具有极高的数据包处理能力。</p><p>通过 XPA，EN7562CT 执行高级 QoS、安全性和灵活的协议管理。</p><p>EN7562CT 还集成了三个专有的 RISC-V 内核，以加速 WiFi 和安全应用程序。</p><p>EN7562CT 采用领先的节能技术制造系统板设计简单易行，提供系统成本低、超低能耗的独特消费者解决方案</p><hr><p>特性：</p><p>高度集成的广域网接口</p><ul class="lvl-0"><li class="lvl-2"><p>符合 ITU-T G.984/G.988和IEEE802.3ah 标准</p></li><li class="lvl-2"><p>支持主动以太网</p></li><li class="lvl-2"><p>提供 MIB 计数器和嗅探器功能，用于快速现场调试非匹配和 Xmart 数据包处理引擎</p></li><li class="lvl-2"><p>Xmart packet 加速器可以支持线速数据包处理和转发无需 CPU 参与的能力</p></li><li class="lvl-2"><p>支持高达 32K 的流量，包括 L2 网桥、IPv4 NAT/路由、IPv4 NAPT、IPv6<br>3/5 元组路由、6RD 和 DS-LITE、NPTv6、VxLAN、NVGRE</p></li><li class="lvl-2"><p>强大的流量分类引擎解析 L2 到 L4 头信息</p></li><li class="lvl-2"><p>TR-156 和 CTC Spec 中定义的灵活 VLAN 转换功能。</p></li><li class="lvl-2"><p>支持 L2 和 L3 组播流和组播 VLAN 转换</p></li><li class="lvl-2"><p>可配置的数据包缓冲区位置，具有高效的基于页面的链表缓冲区管理</p></li><li class="lvl-2"><p>有效的 QoS 方案，包括按流 TrTCM 流量整形、SP/WRR/SP+WRR<br>用于交通调度，尾部下降和红色用于拥堵处理</p></li><li class="lvl-2"><p>支持高达 16K 的 jumboframe<br>高度集成的局域网接口</p></li><li class="lvl-2"><p>x4 GEPHY</p></li><li class="lvl-2"><p>x3 HSGMII 与 PCIE/USB SerDes 的组合。强大的 SoC 平台</p></li><li class="lvl-2"><p>1.0GHz ARM CA53 双核 CPU，256K L2 缓存</p></li><li class="lvl-2"><p>集成三个专有的 RISC-V 内核，用于 WiFi 和安全加速</p></li><li class="lvl-2"><p>支持高达 1GB DDR3-1866 SDRAM</p></li><li class="lvl-2"><p>支持 SPI NOR/NAND 闪存</p></li><li class="lvl-2"><p>两个用于双频 WiFi 应用的 PCIe Gen2 接口</p></li><li class="lvl-2"><p>一个 USB3.0 接口和一个 USB2.0 接口</p></li><li class="lvl-2"><p>提供一个 PCM 或两个 ZSI/ISI 接口</p></li><li class="lvl-2"><p>用于安全应用的内置加密引擎</p></li><li class="lvl-2"><p>两个 UART</p></li><li class="lvl-2"><p>一个 I2C 主机和一个 I2C slave</p></li></ul><hr><p>方框图：</p><p><img src="./BLOCKDIAGRAM.png" alt></p><blockquote><p>注意：图中相关组件标注的型号只是代表该组件的功能相近，并不带不一定是该型号的组件或兼容组件。</p></blockquote><p>SerDes配置：</p><table><thead><tr><th>SerDes 名称</th><th>模式</th></tr></thead><tbody><tr><td>PONSerDes</td><td>PON/HSGMII/5GBASE-R</td></tr><tr><td>PCIe Gen2 SerDes</td><td>PCIe Gen2/HSGMII</td></tr><tr><td>USB3 SerDes</td><td>USB3/HSGMII</td></tr></tbody></table><hr><p>封装工艺:</p><p>LFBGA-361</p><hr><p>基于 en7523 的 SoC</p><p>EN7529DU = EN7523_BASE,</p><p>EN7523DT<br>EN7523DTM<br>EN7523DU<br>EN7523GU<br>EN7523SU</p><p>EN7529CT<br>EN7529CTM<br>EN7529CU<br>EN7529DT<br>EN7529DTM<br>EN7529DU<br>EN7529GTH<br>EN7529GTS<br>EN7529IT<br>EN7529ITM</p><p>EN7562CT<br>EN7562CTM<br>EN7562CU<br>EN7562DT<br>EN7562DTM<br>EN7562DU<br>EN7562GTH<br>EN7562GTS</p><p>达发 ARM(a53/v7l) 命名规则：</p><p>第一位后缀代表频率，从默认频率到最高频率依次为 C(1GHZ)、D(1.2GHZ)、G(1.3GHZ)、P(1.4GHZ)，其中 S/I 是特殊版本（一般是性能更强）。注：括号内的频率并不一定是实际频率，只是为了便于理解。</p><p>第二位后缀代表内存封装，T 代表使用外置 DDR，U 代表使用内置 DDR。</p><p>第三位后缀 H/S，H 代表 Host，S 代表 Slave。</p><blockquote><p>其实这个频率，他是可以超频的，也是可以降频的。如果未来有人研究的话，是可以将最基础的 C 版本超频到 1.4GHz 的，只要你想，改 bl2 的源码，超到 2GHZ 都不是问题，不过这颗芯片发热量巨大，即使降频也很难控制温度。不过用其他版本的厂商实在不多，也没有源码。此外，目前 airoha 新版 SDK(airoha SDK 7.3 kernel 5.4) 是统一 SDK，也就是说，只要你能拿到这个 SDK 的源码，你就可以编译出所有版本的 SoC 的固件（通过不同的 mak 配置）。</p></blockquote><hr><p>基于 EN7528 的 SoC</p><p>EN7528HU<br>EN7528DU<br>EN7561DU<br>EN7526FH_EN7528DU<br>EN7521G_EN7528DU</p><p>基于 EN7580 的 SoC</p><p>EN7580GT<br>EN7580ST<br>EN7580GAT<br>EN7565</p><p>基于 EN7516 的 SoC</p><p>EN7516G</p><p>基于 EN7527 的 SoC</p><p>EN7527G<br>EN7561G</p><p>基于 EN7512 的 SoC</p><p>EN7512<br>EN7513<br>EN7513G</p><p>基于 EN7521, EN7521FC 的 SoC</p><p>EN7521FCUD<br>EN7521F<br>EN7521S<br>EN7526D<br>EN7526F<br>EN7526G<br>EN7526FT<br>EN7526FP<br>EN7526FT_C</p><p>基于 AN7581 的 SoC</p><p>AN7581_BASE,<br>AN7581GT = AN7581_BASE,<br>AN7566GT,<br>AN7581PT,<br>AN7581ST,<br>AN7551PT,<br>AN7581CT,<br>AN7581DT,<br>AN7581FG,<br>AN7581FP,<br>AN7581FD,<br>AN7551GT,<br>AN7566PT,<br>AN7581IT,<br>AN7581SIT,</p><p>基于 AN7552 的 SoC</p><p>AN7552_BASE,<br>AN7552CT = AN7552_BASE,<br>AN7552ST,<br>AN7552FT,<br>AN7563CT,<br>AN7563PT,</p><p>基于 AN7583 的 SoC</p><p>AN7583_BASE,<br>AN7583GT = AN7583_BASE,<br>AN7583GIT,<br>AN7583CT,<br>AN7583DT,<br>AN7583ST,<br>AN9510GT,<br>AN7553GT,<br>AN7553CT,<br>AN7567GT,<br>AN7567CT,<br>AN7583ET,<br>AN7583EIT,<br>AN7583FG,<br>AN7583FP,<br>AN7583FD,<br>AN7583FS,<br>AN7583FF,</p><h2 id="OpenWrt-支持的可能性">OpenWrt 支持的可能性</h2><details><summary>点击展开相关研究过程</summary><p>6月13日记录</p><p>今天有一个新的发现：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21lcmJhbmFuL2Fpcm9oYV9tbC90cmVlL21haW4=">airoha_ml<i class="fa fa-external-link-alt"></i></span></p><p>随后，我又从这些文件中发现了一个名为 <span class="exturl" data-url="aHR0cHM6Ly9kZXYuaW9wc3lzLmV1L2ZlZWQvdGFyZ2V0cw==">IOWRT Airoha integration<i class="fa fa-external-link-alt"></i></span>，目的是移植 Airoha SDK 到 IOWrt(Based On Openwrt)。</p><h3 id="6月15日记录">6月15日记录</h3><p>今天我又发现了一款使用 en7562ct 的设备（不过无线使用 7915）的 make config 文件，发现这是使用21年11月的编译配置，此时它直接使用了 en7523 相关配置，全然没有使用 8850 交换机选项和其他有区别于 en7523 的配置。</p><p>而这些变化发生于 22 年某个时间，发生这些变化的 SDK 来自 23 年，所以我更能确定了，早期的 en7562 设备直接使用 en7523 的设备树进行编译。</p><p>关于交换机，在设备树中的 Frame_Engine 设备中，就有一个交换机的节点。起初查看 /proc/device-tree/ 目录下的设备树文件时，没有发现交换机设备/以太网设备，我还以为是 airoha SDK 的原因，认为实际存在但没在设备树中显示，因为这些设备树的命名难以猜测，以及该设备运行的系统与寻常 linux 不同，似乎叫 tclinux。</p><p>即便不启用属于 en7562 家族的特性，它照样能够运行。</p><blockquote><p>是否好奇没有分区表要怎么启动？我也很好奇，然后查阅了文档，像一些 gpio，分区表，都可以写在 uboot 的环境变量/启动命令中。所以不必纠结分区表了和设备树了。这倒是提醒我备份 u-boot 环境变量十分重要。</p></blockquote><p>此外，我发现，userfs/ 目录下，存在：7523duled.conf、7523guled.conf、7529_62led.conf、7529_cd.conf、led.conf、led_fpga.conf 等文件，这些文件可能是用于配置 LED 灯的。所以，达发的 led gpio 可能是通用的，但也可能是厂商内部定义的。</p><p>通过查看 IOWrt Airoha integration 的代码，发现他们的也使用类似 airoha 的 led 配置方式。同样存在于 <code>userfs/led.conf</code> 文件中。</p><p>通过比较，可以确定 <code>led.conf</code> 并非是通用的，而是特定于某个设备的配置文件。适配系统时，需要通过 patch 的方式来修改该文件。</p><h3 id="6月29日更新">6月29日更新</h3><p>今天抽空连接了 TTL，看了一下 uboot 和 启动 log，看到了一下内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(1) insmod mdio_arht.ko</span><br><span class="line">insmod: cannot open module `/lib/modules/mdio_arht.ko&#x27;: No such file or directory</span><br><span class="line">(2) insmod air_en8811h.ko                                                   writeflash: total write 0x2ac5 bytes</span><br><span class="line"></span><br><span class="line">insmod: cannot open module `/lib/modules/air_en8811h.ko&#x27;: No such file or directory</span><br><span class="line"> [tcPhyInit] in  [tcPhyInit] out , r31 = (10, 0x0)</span><br><span class="line">(3) insmod 8811_bbu_api.ko</span><br><span class="line">insmo  GE R45 AnaCal zcal_idx(before table) (dec: 43) (hex: 0x2b)</span><br><span class="line">  GE R45 AnaCal Done! (cnt:11)(after table) ([7][6:0]:0x56) ([6:0]:0xd6)</span><br><span class="line">d: cannot open module `/lib/modules/8811_bbu_api.ko&#x27;: No such file or directory</span><br><span class="line">an8811 end</span><br></pre></td></tr></table></figure><p>这三个模块都是不存在的，但是系统想要加载它们。<code>en8811h</code> 是一个以太网 PHY 驱动，<code>8811_bbu_api</code> 是一个 BBU 驱动，<code>mdio_arht</code> 是一个 MDIO 驱动。</p><p>竟然不是 <code>en8850</code>，而是 <code>8811h</code>，也证实了不需要 en8850 的驱动。直接使用 en7523 的设备树就可以了。</p><p>然后就是，它真的有 efuse。</p><p>还有一个就是 led 相关的了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcledctrl version: tcledctrl V1.1.0.0 (Nov 10 2023-16:08:25).</span><br><span class="line">ot not found led.conf</span><br><span class="line">led path:/userfs/7529_cd.conf</span><br></pre></td></tr></table></figure><p>以及相关的分区表和 gpio 确实存储在 <code>uboot-env</code> 中。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bootdelay=3</span><br><span class="line">bootfile=tclinux.bin</span><br><span class="line">bootpart=512k[bootloader],12m[rescue],1280k[reservearea],256k[romfile],5m[kernela],33m[rootfsa],5m[kernelb],33m[rootfsb],6m[data],50m[java],78m[osgi]</span><br><span class="line">...</span><br><span class="line">dsl_gpio=0b</span><br><span class="line">ether_gpio=0c</span><br><span class="line">internet_gpio=02</span><br><span class="line">multi_upgrade_gpio=0b020400000000000000000000000000</span><br><span class="line">power_gpio=0b0b</span><br></pre></td></tr></table></figure></details><h2 id="OpenWrt-实战研究">OpenWrt 实战研究</h2><p>7月3日更新</p><p>近几日尝试编译了基于 Linux 6.6 的固件，以及解决相关驱动问题。</p><p>结果是可以启动，但是以太网部分瘫痪，eth、switch、wlan 都无法正常工作。</p><p>另外编译过程中 <code>airoha_eth.c</code> 存在问题，使用 patch 解决了（编译报错，但是无法判断该驱动是否正确），不知道是否是因为这个问题导致以太网无法工作。还有 Airoha spi 驱动的问题需要解决。</p><p>IOWrt Airoha integration 项目可以当作参考，虽然他们开源了一部分代码，但是仍然有很多门槛，无法一步到位直接使用。</p><hr><p>7月5日更新</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1l1emhpaTA3MTgvb3BlbndydC90cmVlL2VuNzU2Mi0yNC4xMA==">en7562-24.10<i class="fa fa-external-link-alt"></i></span></p><p>目前系统能正常启动，但以太网部分仍然无法工作，具体的表现是 system-control/clock-control 无法正常工作，导致相关设备无法正常 resets，尝试使用 an7581 的 scu/syscon/clk 或是 ti 的 gsw resets 驱动，但是没有成功。</p><p>只能等待 airoha/mediatek 开源相关驱动，或是有大佬能提供相关文档/资源。</p><p>你可以尝试该 initramfs 镜像，理论 en7562/en7563 的设备都可以使用</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1l1emhpaTA3MTgvb3BlbndydC9yZWxlYXNlcy8=">Build for Airoha en7562ct<i class="fa fa-external-link-alt"></i></span></p><p>使用方法详见该分支的 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1l1emhpaTA3MTgvb3BlbndydC9ibG9iL2VuNzU2Mi0yNC4xMC9SRUFETUUubWQ=">README<i class="fa fa-external-link-alt"></i></span>。</p><hr><p>7月6日更新</p><p>这个 SoC 网络部分的驱动或许可以结合 en7521 和 an7581 的驱动代码，en7562 很明显是迭代过程的产品，en7521 有泄露的驱动代码，an7581 的驱动代码是官方开源的，但是这种没有 datasheet 的产品，寄存器地址、寄存器位的含义都不清楚，无法进行驱动开发。</p><p>还有我尝试在编译了 arm64 的内核，因为某些驱动原生是 arm64 开发的，不清楚是否兼容 v7l 内核，但是编译出来的内核无法正常开机，启动内核后直接 reset cpu。</p><p>捋一捋，可以发现：</p><ul class="lvl-0"><li class="lvl-2"><p>frame_engine 基于 en7521 的 frame_engine 并加上了一些 PPE/NPU 还有一些 ONU 相关的特性</p></li><li class="lvl-2"><p>wed/wdma 兼容 en751221</p></li><li class="lvl-2"><p>npu 可能是 an7581 npu 的前身</p></li><li class="lvl-2"><p>watchdog 兼容 en7521 的 watchdog</p></li></ul><p>关键的 system-control 部分，我不太清楚，因为 reset-controller/clock-controller 令人折磨，不清楚这个 SoC 是如何工作的。</p><p>但是 an7581 的以太网已经是 eth + switch 的形式了，而加速器部分貌似只使用了 npu，wed、wdma 没有看见相关定义</p><p>wed 见于 mt7622，而 mt7622 上有 wed0、wed1，而该 SoC 上是 wed0、wed2、wed_test，暂时不知道他们的关系。wdma 见于 mt7623。</p><p>然后就是在 an7581 上，npu 用于加速 eth，那么在该 SoC 上，已经存在 npu 了，那么 wed 的作用是什么？</p><blockquote><p>小道消息：TW 某 M 开头芯片大厂据说由于降本增效裁员裁到大动脉，现在 mtwifi 部门与 mt76 部门合并，现在开发驱动的是大学生与阿三，npu 难产，开发3年没有结果，未来将回归 wed + ppe 路线。</p></blockquote><h2 id="关于-uboot">关于 uboot</h2><p>目前该 uboot 是 5.4 内核的，采用 a/b 分区的方式，使用了 ATF2_1 的 U-Boot。</p><p>github 上有一个 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0Fuc3VlbC9hdGYtYWlyb2hh">atf-airoha<i class="fa fa-external-link-alt"></i></span> 提供了一个基于 airoha 的 atf，可以尝试移植。</p><p>但是其实无所谓的，因为uboot该有的功能原版都有。只需要使用时注意备份 uboot 环境变量就行。</p><p>虽然 tftpboot 启动不会破坏分区结构并且还是只读的，但是可能会破坏 uboot 环境变量。</p><p>所以需要在启动前备份 uboot 环境变量。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printenv</span></span><br></pre></td></tr></table></figure><p>将输出的内容保存到一个文件中。</p><p>当环境变量被破环导致无法启动后，可以使用以下命令恢复：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">env</span> default -a <span class="comment"># 恢复默认环境变量</span></span><br><span class="line">saveenv</span><br></pre></td></tr></table></figure><p>然后参照之前的环境变量，重新设置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">env</span> delete &lt;variable_name&gt; <span class="comment"># 删除某个变量</span></span><br><span class="line">setenv &lt;variable_name&gt; &lt;value&gt; <span class="comment"># 设置某个变量</span></span><br><span class="line">saveenv <span class="comment"># 保存环境变量</span></span><br></pre></td></tr></table></figure><p>然后启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flash imgread 2048;\bootm</span><br></pre></td></tr></table></figure><h3 id="总结">总结</h3><p>目前的结论是：</p><p>目前主线 Linux/OpenWrt 可以直接启动所有 airoha mips/arm 的设备。</p><p>但是其他部分，比如 pcie/usb/eth/switch/gpio/watchdog/pinctrl/pwm/wed/npu/etc. 都需要特定的驱动支持。而这些驱动可以期待 airoha/mediatek 开源，或是从大厂的 gpl 代码中获取。</p><h2 id="相关开源以及告一段落">相关开源以及告一段落</h2><p>8月4日更新</p><p>通过大厂的gpl开源，我们仍然能够获取一些东西</p><p>比如：</p><ul class="lvl-0"><li class="lvl-2"><p>netgear gpl 机型 EXS27(BE5000, AN7563PT) 基于 OPENWRT 21.02 mediatek feeds, kernel 5.4</p></li><li class="lvl-2"><p>zyxel gpl 机型 px3321-t1(AX3000, AN7529CT) 基于 OPENWRT 14.07, kernel 4.4</p></li></ul><blockquote><p>netgear的代码倒是比较规范，可以直接使用，但是环境官方没有说明，按照本博客最前面提供的环境进行配置，结合zyxel的环境配置即可，zyxel 的代码需要移植 itb 镜像的打包方法，并且禁用 lzma，改用 gzip 压缩</p></blockquote><p>可以通过移植来支持其他机型，两款机型的 GPL 代码应该能够支持 airoha wifi6/7 基于 en7523 的机型（en7529ct/en7562ct/an7563pt）</p><p>以及一些开源的项目</p><p>比如：</p><ul class="lvl-0"><li class="lvl-2"><p>atf-airoha, 适用于 Airoha SoC 的 ARM Trusted Firmware</p></li><li class="lvl-2"><p>keenetic sdk, 适用于 Keenetic 路由器的开源项目，目前适配了 en7512/en7516/en7528</p></li></ul><blockquote><p>但是呢，由于不知道这些基于 en7523 的型号更新了什么东西，所以驱动也不一定通用，目前可以知道的是，en7529/en7562 是同代产品，但是是否能够用于最初的 en7523 吗，这不一定，至于 en7562 -&gt; en7563，虽然是改进后支持 wifi7，但是有新增了很多特性。</p></blockquote><p>但是，前几天，我把这机器卖了，所以对于这些的研究将告一段落，不再更新了。</p><h2 id="参考资料">参考资料</h2><ul class="lvl-0"><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpZGV2aS53aS1jYXQucnUvVHJlbmRDaGlw">TrendChip<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpZGV2aS53aS1jYXQucnUvRWNvTmV0">EcoNet<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly93aWtpZGV2aS53aS1jYXQucnUvTWVkaWFUZWsvU29D">MediaTek/SoC<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5vcGVud3J0Lm9yZy90L3F1YW50dW0tZmliZXItdzE3MDBrLXN1cHBvcnQv">Quantum Fiber W1700k support - For Developers - OpenWrt Forum<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0h5R3cvdGVzdA==">test_devkit_en7521_20161129.tgz<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NqZGVsaXNsZS9vcGVud3J0Lw==">cjdelisle’s openwrt<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5vcGVud3J0Lm9yZy90L3N1cHBvcnQtZm9yLXp5eGVsLXB4MzMyMS10MS8yMDMzMjQ=">Support for Zyxel - PX3321-T1<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FsZXhjZWx0YXJlMi9wbWc1NjE3Z2E=">Zyxel PMG5617GA router OEM GPL source code a.k.a. OPAL based on OpenWRT 14.07<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5vcGVud3J0Lm9yZy90L29wZW53cnQtc3VwcG9ydC1mb3Itenl4ZWwtcG1nNTYxN2dhLWFuZC1lY29uZXQtc29jcy1maXJzdC1ncG9uLXN1cHBvcnQvMTQ0MjMx">OpenWrt support for Zyxel PMG5617GA and Econet SoCs, first GPON support !?<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0Fuc3VlbC9hdGYtYWlyb2hh">atf-airoha<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tlZW5ldGljL2tlcm5lbC00OQ==">kernel-49<i class="fa fa-external-link-alt"></i></span></p></li><li class="lvl-2"><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tlZW5ldGljL2tlZW5ldGljLXNkaw==">keenetic-sdk<i class="fa fa-external-link-alt"></i></span></p></li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NqZGVsaXNsZS9lY29uZXQtbGludXgtd2lraQ==">econet-linux-wiki<i class="fa fa-external-link-alt"></i></span> <a href="#fnref1" class="footnote-backref">↩︎</a> <a href="#fnref1:1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><span class="exturl" data-url="aHR0cHM6Ly93d3cucHVwYm9zcy5jb20vcG9zdC8yMDI0L3RsLXI1NDA4bS1pbnNwZWN0aW9uLWFuZC1yZXZpZXcv">TL-R5408M 拆机 芯片设计评测<i class="fa fa-external-link-alt"></i></span> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aWZpLm5ldC8yNDA0MC5odG1s">烽火SR1041FU拆机，AX3000无线路由器<i class="fa fa-external-link-alt"></i></span> <a href="#fnref3" class="footnote-backref">↩︎</a> <a href="#fnref3:1" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aWZpLm5ldC8yMzU3Ny5odG1s">TL-R5408M易展路由器拆机和小包转发测试<i class="fa fa-external-link-alt"></i></span> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWN3aWZpLm5ldC8yNTgwMC5odG1s">TL-R5010PE-EN拆机全2.5G POE一体机，弱电箱好野<i class="fa fa-external-link-alt"></i></span> <a href="#fnref5" class="footnote-backref">↩︎</a></p></li></ol></section></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>Yuzhii</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://yuzhii0718.eu.org/2025/07/10/1/" title="达发 airoha en7529&#x2F;en7562&#x2F;an7563 等基于 en7523 的 SoC 构成分析以及 OpenWrt 支持研究（下）">https://yuzhii0718.eu.org/2025/07/10/1/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/%E5%88%86%E4%BA%AB/" rel="tag"><i class="fa fa-tag"></i> 分享</a> <a href="/tags/%E7%8E%A9%E6%9C%BA/" rel="tag"><i class="fa fa-tag"></i> 玩机</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2025/06/07/1/" rel="prev" title="SDG320 en7562ct ax3000 研究（上）"><i class="fa fa-angle-left"></i> SDG320 en7562ct ax3000 研究（上）</a></div><div class="post-nav-item"></div></div></footer></article></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Yuzhii</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">131k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">7:57</span></span></div><div class="translate-style">简/繁：<a id="translateLink" href="javascript:translatePage();" title="切换简/繁体">繁體</a></div><script type="text/javascript" src="/js/tw_cn.js"></script><script type="text/javascript">var defaultEncoding=2,translateDelay=100,cookieDomain="https://yuzhii0718.eu.org/",msgToTraditionalChinese="繁體",msgToSimplifiedChinese="简体",translateButtonId="translateLink";translateInitilization(),document.addEventListener("pjax:complete",function(){translateInitilization()})</script></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://s4.zstatic.net/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/comments.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/utils.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/motion.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/sidebar.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/next-boot.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/pjax.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/third-party/search/local-search.min.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://s4.zstatic.net/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/third-party/tags/mermaid.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/third-party/fancybox.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/third-party/pace.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/Darkmode.js/1.5.7/darkmode-js.min.js"></script><script>var options={bottom:"-1rem",right:"-1rem",left:"unset",time:"0.5s",mixColor:"transparent",backgroundColor:"transparent",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"🌓",autoMatchOsTheme:!0};let darkmode=new Darkmode(options);(window.darkmode=darkmode).showWidget()</script><script>1e3<screen.width&&(document.write(decodeURI("%3Cscript%20type=%22text/javascript%22%20src=%22/js/src/ribbon.min.js%22%3E%3C/script%3E")),document.write(decodeURI("%3Cscript%20type=%22text/javascript%22%20src=%22/js/src/version-info.js%22%3E%3C/script%3E")))</script></body></html>